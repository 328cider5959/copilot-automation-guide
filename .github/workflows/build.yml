name: Build LaTeX and Create Release

on:
  push:
    tags:
      - 'v*' # バージョンタグで実行（例: v1.0.0）
  workflow_dispatch: # 手動実行も可能

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1. リポジトリをチェックアウト
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. 日本語対応LaTeX環境をインストール
      - name: Install LaTeX (Japanese support)
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            texlive-lang-japanese \
            texlive-latex-extra \
            texlive-fonts-recommended \
            texlive-fonts-extra \
            latexmk zip

      # 3. LaTeXビルド（latexmk + uplatex）
      - name: Build PDF using Makefile
        run: |
          cd latex
          make latexmk

      # 4. ZIP生成スクリプト実行
      - name: Run ZIP script
        run: |
          chmod +x scripts/zip.sh
          ./scripts/zip.sh

      # 5. GitHub Release作成＆成果物アップロード
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            latex/guide.pdf
            starter-kit.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}